@section Styles{
    <link href="~/css/reservations.css" rel="stylesheet" />
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vue2-datepicker@3.11.0/index.css">
<main id="main">
    <div id="d1">
        <!-- ======= Book A Table Section ======= -->
        <section id="book-a-table" class="book-a-table">
            <div class="container" data-aos="fade-up">
                <div class="section-title">
                    <h2>立即訂位</h2>
                    <p>訂位</p>
                </div>
                <form role="form" class="php-email-form" data-aos="fade-up" data-aos-delay="100">
                    <div class="row">
                        <label>用餐人數</label>
                        <div class="col-lg-4 col-md-6 form-group d-flex">
                            <select name="" id="adultPicker" class="book-a-table form-control form-select" v-model="adultNumber" required>
                                <option value="" disabled>請選擇大人人數</option>
                                <template v-for="ad in adultPicker">
                                    <option>{{ad.txt}}</option>
                                </template>
                            </select>
                            <select name="" id="kidPicker" class="book-a-table form-control form-select" v-model="kidNumber">
                                <option value="" disabled>請選擇小孩人數</option>
                                <template v-for="k in kidPicker">
                                    <option>{{k.txt}}</option>
                                </template>
                            </select>
                        </div>
                    </div>
                    <!-- datepicke -->
                    <label for="datepicker">用餐日期</label>
                    <div id="d1" class="calendar">
                        <!-- datepicker這邊要調整 -->
                        <date-picker v-model="ReserveDate"
                                     value-type="format"
                                     name="ReserveDate"
                                     id="datepicker"
                                     class="datepicker p-0"
                                     placeholder="請選擇用餐日期"></date-picker>
                    </div>
                    <label>用餐時段</label>
                    <div class="col-lg-2 col-md-6 form-group" id="mealTimePicker">
                        <select name="time" id="mealTimePicker" class="book-a-table form-control" v-model="mealTime">
                            <option value="" disabled>請選擇用餐時段</option>
                            <template v-for="mt in mealTimePicker">
                                <option>{{mt.txt}}</option>
                            </template>
                        </select>
                    </div>
                    <br />
                    <label>餐廳位置</label>
                    <br />
                    <div data-aos="fade-up">
                        <iframe style="border: 0; width: 50%; height: 250px"
                                src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d12097.433213460943!2d-74.0062269!3d40.7101282!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0xb89d1fe6bc499443!2sDowntown+Conference+Center!5e0!3m2!1smk!2sbg!4v1539943755621"
                                frameborder="0" allowfullscreen>
                        </iframe>
                    </div>
                </form>
            </div>
        </section>

        <footer class="footer">
            <div class="form-group fixed-footer-content" id="finalReservation">
                <div aria-hidden="true" id="yourReservation">
                    <p for="text">您已選擇預訂</p>
                    <span>
                        <template v-if="adultNumber==''">
                            <button id="adultShow">大人人數</button>
                        </template>
                        <template v-else>
                            <button id="adultShow">{{adultNumber}}</button>
                        </template>
                    </span>
                    <span>
                        <template v-if="kidNumber==''">
                            <button id="kidShow">小孩人數</button>
                        </template>
                        <template v-else>
                            <button id="kidShow">{{kidNumber}}</button>
                        </template>
                    </span>
                    <span><img src="~/img/right-arrow.png" alt="" id="rightArrow" /></span>
                    <span>
                        <template v-if="ReserveDate!=null">
                            <button id="dateShow">{{ReserveDate}}</button>
                        </template>
                        <template v-else>
                            <button id="dateShow">訂位日期</button>
                        </template>
                    </span>
                    <span><img src="~/img/right-arrow.png" alt="" id="rightArrow" /></span>
                    <span>
                        <template v-if="mealTime==''">
                            <button id="timeShow">訂位時段</button>
                        </template>
                        <template v-else>
                            <button id="timeShow">{{mealTime}}</button>
                        </template>
                    </span>
                </div>
                <div class="text-center book-a-table php-email-form " id="reservationNext">
                    <button type="submit" id="show" @@click="next" :disabled="disSet" :class="disClass">下一步，填寫聯絡資訊</button>
                </div>
                <dialog id="infoModal" class="text-center book-a-table php-email-form">
                    <h1 id="houseRule">規則與注意事項</h1>
                    <div id="ruleContainer">
                        <p>【預約時的注意事項】</p>
                        <p>-餐廳接受一個月內的線上訂位。</p>
                        <p>-用餐時間120分鐘。</p>
                        <p>-只為有效聯絡電話之預訂保留座位。</p>
                        <p>-於線上訂位成功後，若餐廳無法聯繫上訂位人做訂位確認時，本餐廳將保有取消其訂位之權利。</p>
                        <p>-為確保客人用餐權益，若需取消或更改訂位，請提前告知。</p>
                        <p>-訂位將保留15分鐘，若逾時將自動取消訂位。</p>
                        <p>-線上預訂系統將自動安排座位，如需指定座位請致電至餐廳。</p>
                        <p>-特殊節日恕不接受線上預訂。</p>
                        <p>-本餐廳保留條款內容變更與解釋、暫停或終止本線上訂位之權利。</p>
                        <p>服裝儀容：</p>
                        <p>賓客請避免穿著拖鞋，男士請避免穿著無袖背心</p>
                    </div>
                    <div id="noticeRule">
                        <p>* 請詳細閱讀規則與注意事項</p>
                        <button id="confirmRulebBtn" type="button" @@click.prevent="next">我已閱讀並同意規則與注意事項</button>
                    </div>
                </dialog>
        </footer>
    </div>
</main>
<!-- End Book A Table Section -->
@section Scripts
    {
    <script src="~/axios/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue2-datepicker@3.11.0/index.js"></script>
    <script>
        /*填完用餐訊息轉到dialog*/
        let btn = document.querySelector("#show");
        let infoModal = document.querySelector("#infoModal");
        let close = document.querySelector("#close");
        btn.addEventListener("click", function () {
            infoModal.showModal();
        });
        confirmRulebBtn.addEventListener("click", function () {
            infoModal.close();
        });
        baseAddress = "https://localhost:7071";
        let app = new Vue({
            el: "#d1",
            data: {
                showmodal: false,
                ReserveDate: null,
                adultNumber: '',
                kidNumber: '',
                mealTime: '',
                dis: null,
                disColor: "",
                adultPicker: [
                    { value: 1, txt: '1位大人' },
                    { value: 2, txt: '2位大人' },
                    { value: 3, txt: '3位大人' },
                    { value: 4, txt: '4位大人' },
                    { value: 5, txt: '5位大人' }],
                kidPicker: [
                    { value: 0, txt: '0位小孩' },
                    { value: 1, txt: '1位小孩' },
                    { value: 2, txt: '2位小孩' },
                    { value: 3, txt: '3位小孩' },
                    { value: 4, txt: '4位小孩' }],
                mealTimePicker: [
                    { value: 11, txt: '11: 00' },
                    { value: 13, txt: '13: 00' },
                    { value: 15, txt: '15: 00' },
                    { value: 17, txt: '17: 00' },
                    { value: 19, txt: '19: 00' }],
            },
            computed: {
                disSet: function () {
                    if (this.adultNumber == '' || this.kidNumber == '' || this.ReserveDate == null || this.mealTime == '') {
                        this.disColor = "nono";
                        return this.dis = true;
                    }
                    else {
                        return this.dis = false
                    }
                },
                disClass: function () {
                    if (this.adultNumber == '' || this.kidNumber == '' || this.ReserveDate == null || this.mealTime == '') {
                        return this.disColor = "nono";
                    }
                    else {
                        return this.disColor = ""
                    }
                },
            },
            methods: {
                next: function () {
                    let _this=this;
                    var request={
                        ReservationDate: _this.ReserveDate,
                        NumberofAdultGuest: _this.adultNumber,
                        NumberofKidGuest: _this.kidNumber,
                        ReservationTime: _this.mealTime,
                    }
                    if (this.adultNumber != '' || this.kidNumber != '' || this.ReserveDate != null || this.mealTime != '') {
                        window.location.href = `Reservations/booking`
                        axios.post("https://localhost:7071/api/Reservations/PostReservation", request)
                            .then(
                                response => {
                                    alert(response.data);
                                })
                    }
                }
            },
        });
    </script>
    }
